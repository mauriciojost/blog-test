<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Mauricio Jost">
  <meta name="theme-color" content="#284a5e">
  <title>Partial Functions in Scala</title>
  <meta name="description" content="What is a partial function?">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://mauriciojost.github.io/2016/09/01/partial-functions-in-scala.html">
  <link rel="alternate" type="application/rss+xml" title="Mauricio Jost" href="http://mauriciojost.github.io/feed.xml">
</head>

<body>
	<div id="container">
		<div id="row">
			<header id="sidebar">
  <a href="/"/>
    <img src="/images/mjost-profile-photo.jpg" class="avatar" alt="Mauricio Jost" />
  </a>

  <h1>
    <strong>I am Mauricio</strong><br />and these are my two cents</h1> 

  <nav class="site-nav vspace">
    <a href="/" class="navlink">Blog</a>
    <span style="font-size: 10px;">&nbsp;&bull;&nbsp;</span>
    <a href="/archives" class="navlink">Archives</a>
    <span style="font-size: 10px;">&nbsp;&bull;&nbsp;</span>
    <a href="/about" class="navlink">About</a>
  </nav>

  <ul class="icons vspace">
    <li><a href="https://www.linkedin.com/in/mauriciojost/" class="icon fa-linkedin" title="Linkedin profile"><span class="label">Linkedin</span></a></li>
    <li><a href="https://github.com/mauriciojost" class="icon fa-github" title="Github profile"><span class="label">Github</span></a></li>
    <li><a href="http://stackoverflow.com/users/1554927/mauriciojost" class="icon fa-stack-overflow" title="Stackoverflow profile"><span class="label">Stack Overflow</span></a></li>
  </ul>
</header>

			<section id="page-content">
				<div id="content">
					<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <p class="post-meta"><time datetime="2016-09-01T00:00:00+02:00" itemprop="datePublished">Sep 1, 2016</time></p>
    <h1 class="post-title" itemprop="name headline">Partial Functions in Scala</h1>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="what-is-a-partial-function">What is a partial function?</h2>

<p>In short, a partial function is simply a mathematical function <em>f: X-&gt;Y</em> that is not defined for some elements in the domain <em>X</em>.</p>

<p>The typical example is <em>f: 1/x</em> , not defined when <em>x = 0</em>.</p>

<h2 id="but-what-is-a-partial-function-in-scala">But, what is a partial function in Scala?</h2>

<p>It is a Scala trait that allows to express a partial function. For instance...</p>

<!--more-->

<p>The previous example would be expressed as: </p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">div</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PartialFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="nf">isDefinedAt</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="o">}</span>
</code></pre></div>
<p>Or more concisely (using pattern matching):</p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">positives</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">if</span> <span class="kt">x</span> <span class="kt">&gt;</span> <span class="err">0</span> <span class="o">=&gt;</span> <span class="n">x</span>
<span class="o">}</span>
</code></pre></div>
<h2 id="why-should-i-use-it">Why should I use it?</h2>

<h3 id="because-they-are-extensively-used-in-the-scala-api">Because they are extensively used in the Scala API</h3>

<p>Really. For instance, the root of all collections (the trait Traversable) defines the method</p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="nf">collect</span><span class="o">[</span><span class="kt">Y</span><span class="o">](</span><span class="n">pf</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">X</span>, <span class="kt">Y</span><span class="o">])</span><span class="k">:</span> <span class="kt">Traversable</span><span class="o">[</span><span class="kt">Y</span><span class="o">]</span>
</code></pre></div>
<p>that allows to create a List[Y] from some elements of a List[X]. Knowing the API will let you have more choices when tackling a problem and surely be a better developer.</p>

<h3 id="because-they-are-efficient">Because they are efficient</h3>

<p>Consider the function <em>f: x.toString</em> where <em>x &gt; 0</em> similar to the one I mentioned above. This could be expressed as: </p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">positivesAsStrings</span> <span class="k">=</span> 
      <span class="nv">numbers</span><span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">n</span> <span class="k">=&gt;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nv">x</span><span class="o">.</span><span class="py">toString</span><span class="o">)</span>
</code></pre></div>
<p>But there is something nasty about it. After the filter call, Scala will create an intermediate collection on which it will apply the map call. If your intermediate collection is large (letâ€™s say you have a million of integers and a high percentage is positive) you will waste time creating this discardable intermediate object.
However, if using collect(partialFunction) instead, we will be populating the the final collection right away. Think of the amount of garbage collection you could save!</p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">positivesAsStringsPF</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">if</span> <span class="kt">x</span> <span class="kt">&gt;</span> <span class="err">0</span> <span class="o">=&gt;</span> <span class="nv">x</span><span class="o">.</span><span class="py">toString</span>
<span class="o">}</span>
<span class="k">val</span> <span class="nv">positivesAsStrings</span> <span class="k">=</span> 
      <span class="nv">numbers</span><span class="o">.</span><span class="py">collect</span><span class="o">(</span><span class="n">positivesAsStringsPF</span><span class="o">)</span>
</code></pre></div>
<h3 id="because-they-ease-modularization-and-can-be-combined">Because they ease modularization and can be combined</h3>

<p>When using pattern matching we use blocks like this one:</p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">result</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">parameter</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">p</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">asString</span><span class="o">(</span><span class="n">p</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="s">"default"</span>
<span class="o">}</span>
</code></pre></div>
<p>Here we provide the domain on which we want to apply a function (on defined monads, and also undefined monads in this case), and the function itself for each case. For the sake of modularization, this can be expressed as a set of partial functions combined together:</p>
<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">pfForSome</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">asString</span><span class="o">(</span><span class="n">p</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">pfForNone</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="n">default</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">pfForSomeAndNone</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> 
      <span class="nv">pfForSome</span><span class="o">.</span><span class="py">orElse</span><span class="o">(</span><span class="n">pfForNone</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">resultAsOption</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> 
      <span class="nv">parameter</span><span class="o">.</span><span class="py">collect</span><span class="o">(</span><span class="n">pfForSomeAndNone</span><span class="o">)</span>
</code></pre></div>
<h2 id="want-to-know-more">Want to know more?</h2>

<p><a href="http://blog.bruchez.name/2011/10/scala-partial-functions-without-phd.html">I really liked this post</a>, I encourage you to take a look.</p>

<p><strong>Won&#39;t you partial-function-ize anything?</strong></p>

  </div>

  <hr/>

  <div itemprop="keywords">
    Tags:
    
      <a href="http://www.google.com/search?q=scala&btnI=I%27m%20feeling%20lucky">scala</a>, 
    
      <a href="http://www.google.com/search?q=partial&btnI=I%27m%20feeling%20lucky">partial</a>, 
    
      <a href="http://www.google.com/search?q=functions&btnI=I%27m%20feeling%20lucky">functions</a>, 
    
      <a href="http://www.google.com/search?q=collect&btnI=I%27m%20feeling%20lucky">collect</a>, 
    
      <a href="http://www.google.com/search?q=collections&btnI=I%27m%20feeling%20lucky">collections</a>
    
  </div>
</article>





<div id="disqus_thread"></div>
<script type="text/javascript">
        var disqus_shortname = 'mauriciojost-github-io';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




				</div>
			</section>
		</div>
	</div>
	<script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
